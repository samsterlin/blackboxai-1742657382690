<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tamil Nadu Vehicle & License Verification</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-blue-600 text-white py-6 shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <i class="fas fa-car-side text-3xl mr-3"></i>
                    <h1 class="text-2xl font-bold">Tamil Nadu Vehicle & License Verification</h1>
                </div>
                <nav>
                    <a href="#" class="hover:text-blue-200 transition-colors">Help</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="grid md:grid-cols-2 gap-8">
            <!-- Vehicle Registration Section -->
            <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                <div class="flex items-center mb-6">
                    <i class="fas fa-car text-3xl text-blue-600 mr-3"></i>
                    <h2 class="text-xl font-semibold">Vehicle Registration Verification</h2>
                </div>
                <form id="vehicleForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 mb-2" for="vehicleNumber">
                            Vehicle Registration Number
                        </label>
                        <input type="text" id="vehicleNumber" 
                               class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="Enter TN vehicle number (e.g., TN01AB1234)"
                               pattern="^TN[0-9]{2}[A-Z]{2}[0-9]{4}$"
                               required>
                    </div>
                    <button type="submit" 
                            class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center">
                        <i class="fas fa-search mr-2"></i>
                        Verify Vehicle
                    </button>
                </form>
                <div id="vehicleResult" class="mt-4 hidden">
                    <!-- Results will be displayed here -->
                </div>
            </div>

            <!-- License Verification Section -->
            <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                <div class="flex items-center mb-6">
                    <i class="fas fa-id-card text-3xl text-green-600 mr-3"></i>
                    <h2 class="text-xl font-semibold">Driving License Verification</h2>
                </div>
                <form id="licenseForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 mb-2" for="licenseNumber">
                            Driving License Number
                        </label>
                        <input type="text" id="licenseNumber" 
                               class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                               placeholder="Enter TN license number (e.g., TN0120220001234)"
                               required>
                        <div class="mt-4">
                            <label class="block text-gray-700 mb-2" for="dob">
                                Date of Birth
                            </label>
                            <input type="date" id="dob" 
                                   class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                   required>
                        </div>
                    </div>
                    <button type="submit" 
                            class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center">
                        <i class="fas fa-search mr-2"></i>
                        Verify License
                    </button>
                </form>
                <div id="licenseResult" class="mt-4 hidden">
                    <!-- Results will be displayed here -->
                </div>
            </div>
        </div>

        <!-- Information Section -->
        <div class="mt-8 bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-xl font-semibold mb-4">Important Information</h3>
            <div class="grid md:grid-cols-3 gap-6">
                <div class="flex items-start">
                    <i class="fas fa-info-circle text-blue-600 text-xl mt-1 mr-3"></i>
                    <div>
                        <h4 class="font-medium mb-2">Valid Format</h4>
                        <p class="text-gray-600">Enter TN registration number (e.g., TN01AB1234)</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <i class="fas fa-shield-alt text-blue-600 text-xl mt-1 mr-3"></i>
                    <div>
                        <h4 class="font-medium mb-2">Data Privacy</h4>
                        <p class="text-gray-600">Your search data is secure and not stored</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <i class="fas fa-clock text-blue-600 text-xl mt-1 mr-3"></i>
                    <div>
                        <h4 class="font-medium mb-2">Real-time Results</h4>
                        <p class="text-gray-600">Get instant verification from official database</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="text-center md:text-left mb-4 md:mb-0">
                    <p>&copy; 2024 Tamil Nadu Vehicle & License Verification Portal</p>
                    <p class="text-gray-400 text-sm">Powered by Parivahan VAHAN & SARATHI</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Vehicle Form Submission
        document.getElementById('vehicleForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const vehicleNumber = document.getElementById('vehicleNumber').value;
            const resultDiv = document.getElementById('vehicleResult');
            
            try {
                // Show loading state
                resultDiv.innerHTML = `
                    <div class="flex items-center justify-center p-4">
                        <i class="fas fa-spinner fa-spin text-blue-600 text-2xl"></i>
                    </div>
                `;
                resultDiv.classList.remove('hidden');

                // Format vehicle number (remove spaces)
                const formattedVehicleNumber = vehicleNumber.replace(/\s/g, '');
                
                const response = await fetch('http://localhost:5000/api/vehicle', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        registrationNumber: formattedVehicleNumber
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch vehicle details');
                }

                const data = await response.json();

                resultDiv.innerHTML = `
                    <div class="p-4 border rounded-lg bg-blue-50">
                        <h3 class="font-semibold text-lg mb-2">Vehicle Details</h3>
                        <div class="space-y-2">
                            <p class="text-gray-700"><span class="font-medium">Registration Number:</span> ${data.registrationNumber}</p>
                            <p class="text-gray-700"><span class="font-medium">Owner Name:</span> ${data.ownerName}</p>
                            <p class="text-gray-700"><span class="font-medium">Registration Date:</span> ${data.registrationDate}</p>
                            <p class="text-gray-700"><span class="font-medium">Vehicle Class:</span> ${data.vehicleClass}</p>
                            <p class="text-gray-700"><span class="font-medium">Fuel Type:</span> ${data.fuelType}</p>
                            <p class="text-gray-700"><span class="font-medium">Make:</span> ${data.makerName}</p>
                            <p class="text-gray-700"><span class="font-medium">Model:</span> ${data.modelName}</p>
                            <p class="text-gray-700"><span class="font-medium">Status:</span> 
                                <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm">${data.status}</span>
                            </p>
                            <p class="text-gray-700"><span class="font-medium">Tax Valid Till:</span> ${data.taxValidUpto}</p>
                            <p class="text-gray-700"><span class="font-medium">Insurance Valid Till:</span> ${data.insuranceValidUpto}</p>
                            <p class="text-gray-700"><span class="font-medium">Fitness Valid Till:</span> ${data.fcValidUpto}</p>
                            <p class="text-gray-700"><span class="font-medium">PUC Valid Till:</span> ${data.pucValidUpto}</p>
                            <p class="text-gray-700"><span class="font-medium">RC Status:</span> ${data.rcStatus}</p>
                        </div>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="p-4 border rounded-lg bg-red-50 text-red-700">
                        <p>Error: Unable to fetch vehicle details. Please try again later.</p>
                    </div>
                `;
            }
        });

        // License Form Submission
        document.getElementById('licenseForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const licenseNumber = document.getElementById('licenseNumber').value;
            const dob = document.getElementById('dob').value;
            const resultDiv = document.getElementById('licenseResult');
            
            try {
                // Show loading state
                resultDiv.innerHTML = `
                    <div class="flex items-center justify-center p-4">
                        <i class="fas fa-spinner fa-spin text-green-600 text-2xl"></i>
                    </div>
                `;
                resultDiv.classList.remove('hidden');

                // Format license number (remove spaces and hyphens)
                const formattedLicenseNumber = licenseNumber.replace(/[\s-]/g, '');
                
                // Format date to dd-mm-yyyy
                const formattedDob = new Date(dob).toLocaleDateString('en-GB', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                }).split('/').join('-');
                
                const response = await fetch('http://localhost:5000/api/license', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        licenseNumber: formattedLicenseNumber,
                        dob: formattedDob
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch license details');
                }

                const data = await response.json();

                resultDiv.innerHTML = `
                    <div class="p-4 border rounded-lg bg-green-50">
                        <h3 class="font-semibold text-lg mb-2">License Details</h3>
                        <div class="space-y-2">
                            <p class="text-gray-700"><span class="font-medium">License Number:</span> ${data.dlNumber}</p>
                            <p class="text-gray-700"><span class="font-medium">Holder Name:</span> ${data.holderName}</p>
                            <p class="text-gray-700"><span class="font-medium">Father's Name:</span> ${data.fatherName}</p>
                            <p class="text-gray-700"><span class="font-medium">Date of Issue:</span> ${data.issueDate}</p>
                            <p class="text-gray-700"><span class="font-medium">Valid From:</span> ${data.validFrom}</p>
                            <p class="text-gray-700"><span class="font-medium">Valid Upto:</span> ${data.validUpto}</p>
                            <p class="text-gray-700"><span class="font-medium">Vehicle Classes:</span> ${data.vehicleClass.join(", ")}</p>
                            <p class="text-gray-700"><span class="font-medium">Issuing Authority:</span> ${data.issuingAuthority}</p>
                            <p class="text-gray-700"><span class="font-medium">Status:</span> 
                                <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm">${data.status}</span>
                            </p>
                            <p class="text-gray-700"><span class="font-medium">Blood Group:</span> ${data.bloodGroup}</p>
                            <p class="text-gray-700"><span class="font-medium">Address:</span> ${data.permanentAddress}</p>
                            <p class="text-gray-700"><span class="font-medium">Badge Number:</span> ${data.badgeNumber || 'N/A'}</p>
                            <p class="text-gray-700"><span class="font-medium">Last Transaction:</span> ${data.lastTransactionAt}</p>
                        </div>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="p-4 border rounded-lg bg-red-50 text-red-700">
                        <p>Error: Unable to fetch license details. Please try again later.</p>
                    </div>
                `;
            }
        });

        // Form validation
        document.getElementById('vehicleNumber').addEventListener('input', (e) => {
            e.target.value = e.target.value.toUpperCase();
        });

        document.getElementById('licenseNumber').addEventListener('input', (e) => {
            e.target.value = e.target.value.toUpperCase();
        });
    </script>
</body>
</html>